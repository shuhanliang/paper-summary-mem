<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学术周报生成器 - 海报版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* 为简洁起见，省略了您已有的、且未改动的CSS样式 */
        body { font-family: 'Inter', sans-serif; background-color: #e9eef2; }
        .keyword-tag-display { transition: all 0.2s ease-in-out; cursor: pointer; }
        .keyword-tag-display:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .paper-card-new-badge { position: absolute; top: -10px; right: -10px; background-color: #ef4444; color: white; font-size: 0.75rem; font-weight: 700; padding: 2px 8px; border-radius: 9999px; transform: rotate(15deg); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #report-content-wrapper { perspective: 1500px; width: 100%; height: calc(100vh - 300px); min-height: 600px; margin: 0 auto; }
        #report-content { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; padding: 20px 0; height: 100%; scrollbar-width: none; -ms-overflow-style: none; }
        #report-content::-webkit-scrollbar { display: none; }
        .report-card-poster { scroll-snap-align: center; flex: 0 0 calc(min(90%, 595px)); height: calc(100% - 40px); margin: 0 15px; border-radius: 16px; background-color: #ffffff; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.6s ease-out; transform-style: preserve-3d; opacity: 0.7; transform: scale(0.9); overflow: hidden; aspect-ratio: 1/1.414; }
        .report-card-poster.is-active { opacity: 1; transform: scale(1); }
        .poster-grid { display: grid; grid-template-columns: 38% 62%; height: 100%; }
        .poster-left-column { background-color: #f0f4f8; padding: 24px; display: flex; flex-direction: column; justify-content: space-between; border-right: 1px solid #dde4eb; overflow-y: auto; }
        .poster-right-column { padding: 24px; display: flex; flex-direction: column; overflow-y: auto; }
        .poster-section-title { font-size: 0.9rem; font-weight: 600; color: #1e3a8a; margin-top: 16px; margin-bottom: 8px; border-bottom: 2px solid #60a5fa; padding-bottom: 4px; display: inline-block; }
        .poster-interpretation-subsection h5 { font-weight: 700; color: #334155; margin-bottom: 4px; }
        .poster-interpretation-subsection p { font-size: 0.85rem; color: #475569; line-height: 1.6; text-align: justify; }

    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center py-8 px-4">

    <div class="container mx-auto max-w-5xl w-full">
        <header class="mb-6 text-center">
            <h1 class="text-4xl font-bold text-sky-700">学术周报</h1>
            <p class="text-slate-600 mt-2">每日清晨，为您定制专属学术动态 <span id="update-count-badge" class="hidden ml-2 text-xs font-semibold bg-green-200 text-green-800 px-2 py-0.5 rounded-full"></span></p>
        </header>

        <section id="keywords-display-area" class="mb-8 p-6 bg-white rounded-xl shadow-lg">
            </section>

        <main id="report-content-wrapper">
            <div id="report-content">
                <div id="loading-message-container" class="w-full h-full flex items-center justify-center text-slate-600">
                    <p id="loading-message">正在加载学术周报...</p>
                </div>
            </div>
        </main>

        <footer class="mt-12 text-center text-sm text-slate-500">
            <p>&copy; <span id="current-year"></span> 学术周报生成器.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reportContentDiv = document.getElementById('report-content');
            const manualKeywordsContainer = document.getElementById('manual-keywords-display'); // 假设您已添加
            const hotKeywordsContainer = document.getElementById('hot-keywords-display'); // 假设您已添加
            const updateCountBadge = document.getElementById('update-count-badge');
            const LAST_VIEWED_UPDATE_KEY = 'lastViewedUpdateTime';

            // ---【补全点1：新增`renderInterpretation`函数】---
            // 这个函数负责将结构化的interpretation对象转换为美观的HTML
            function renderInterpretation(interpretation) {
                if (typeof interpretation !== 'object' || interpretation === null) {
                    return `<p>${interpretation || '暂无深入解读。'}</p>`;
                }

                const fieldTitles = {
                    core_contribution: '核心贡献与创新',
                    methodology_summary: '方法总结',
                    performance_evaluation: '性能评估',
                    inferred_application: '应用推断',
                    survey_scope: '综述范围',
                    taxonomy_or_structure: '分类体系与结构',
                    key_trends_and_insights: '关键趋势与洞见',
                    target_audience: '目标读者'
                };
                
                let html = '';
                for (const key in interpretation) {
                    if (Object.hasOwnProperty.call(interpretation, key) && interpretation[key]) {
                        html += `
                            <div class="poster-interpretation-subsection mb-3">
                                <h5>${fieldTitles[key] || key}</h5>
                                <p>${interpretation[key]}</p>
                            </div>
                        `;
                    }
                }
                return html || '<p>暂无深入解读。</p>';
            }

            fetch('academic_data.json?t=' + new Date().getTime()) // 添加时间戳防止缓存
                .then(response => response.json())
                .then(data => {
                    const { keywords, papers, lastUpdate } = data;
                    const lastViewedTime = localStorage.getItem(LAST_VIEWED_UPDATE_KEY);

                    // 渲染关键词
                    if (keywords.manual && manualKeywordsContainer) {
                        manualKeywordsContainer.innerHTML = keywords.manual.map(k => `<span class="keyword-tag-display bg-sky-100 text-sky-700 text-sm font-medium px-3 py-1.5 rounded-full">${k}</span>`).join('');
                    }
                    if (keywords.hot && hotKeywordsContainer) {
                        hotKeywordsContainer.innerHTML = keywords.hot.map(k => `<span class="keyword-tag-display bg-orange-100 text-orange-700 text-sm font-medium px-3 py-1.5 rounded-full">${k}</span>`).join('');
                    }
                    
                    // 渲染论文卡片
                    reportContentDiv.innerHTML = ''; // 清空加载信息
                    const papersToShow = papers.slice(0, 4);
                    let newPapersCount = 0;

                    if (papersToShow.length === 0) {
                        reportContentDiv.innerHTML = `<div id="loading-message-container" class="w-full h-full flex items-center justify-center text-slate-600"><p>暂无精选论文。</p></div>`;
                    }

                    papersToShow.forEach((paper, index) => {
                        const card = document.createElement('article');
                        card.className = 'report-card-poster';
                        card.style.position = 'relative';

                        const isNew = lastViewedTime && new Date(paper.publicationDate) >= new Date(lastViewedTime);
                        if (isNew) {
                            newPapersCount++;
                        }
                        
                        // ---【补全点2：填充完整的innerHTML逻辑】---
                        const authorsHtml = paper.authors.map(author => `${author}`).join(', ');
                        const keywordsHtml = paper.paperKeywords.map(k => `<span class="poster-keywords-tag bg-sky-100 text-sky-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${k}</span>`).join('');
                        const interpretationHtml = renderInterpretation(paper.interpretation); // 调用新函数

                        card.innerHTML = `
                            <div class="poster-grid">
                                <div class="poster-left-column">
                                    <div>
                                        <h3 class="text-xl font-bold text-sky-800 mb-2">${paper.title}</h3>
                                        <p class="text-sm text-slate-600 mb-4"><strong>作者:</strong> ${authorsHtml}</p>
                                    </div>
                                    <div class="poster-journal-info mt-auto pt-4 border-t border-slate-300">
                                        <p><strong>期刊/来源:</strong> ${paper.journal}</p>
                                        <p><strong>发表日期:</strong> ${paper.publicationDate}</p>
                                    </div>
                                </div>
                                <div class="poster-right-column">
                                    <h4 class="poster-section-title">摘要</h4>
                                    <p class="text-slate-700 text-sm text-justify leading-relaxed mb-4">${paper.snippet}</p>
                                    
                                    <h4 class="poster-section-title">关键词</h4>
                                    <div class="flex flex-wrap gap-2 my-2">${keywordsHtml}</div>

                                    <h4 class="poster-section-title">深入解读</h4>
                                    <div class="poster-interpretation mt-2 flex-grow overflow-y-auto pr-2">
                                        ${interpretationHtml}
                                    </div>
                                    
                                    <footer class="mt-auto pt-4">
                                        ${paper.url && paper.url !== "#" ? `<a href="${paper.url}" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-sky-600 text-white font-semibold py-2 rounded-lg hover:bg-sky-700 transition">阅读原文 &rarr;</a>` : ''}
                                    </footer>
                                </div>
                            </div>
                        `;
                        
                        // 如果是新论文，添加角标
                        if(isNew) {
                            const newBadge = document.createElement('div');
                            newBadge.className = 'paper-card-new-badge';
                            newBadge.textContent = 'New';
                            card.appendChild(newBadge);
                        }

                        reportContentDiv.appendChild(card);
                    });
                    
                    // 更新“今日更新”计数
                    if (newPapersCount > 0) {
                        updateCountBadge.textContent = `新增 ${newPapersCount} 篇`;
                        updateCountBadge.classList.remove('hidden');
                    }

                    // 更新本次查看时间
                    localStorage.setItem(LAST_VIEWED_UPDATE_KEY, lastUpdate);
                })
                .catch(error => {
                    console.error('Error fetching or processing data:', error);
                    reportContentDiv.innerHTML = `<div id="loading-message-container" class="w-full h-full flex items-center justify-center text-red-600"><p>❌ 加载数据失败，请检查 academic_data.json 文件是否存在或格式是否正确。</p></div>`;
                });
            
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>