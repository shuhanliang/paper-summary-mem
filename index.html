<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦æœ¯å‘¨æŠ¥ç”Ÿæˆå™¨ - æµ·æŠ¥ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* ä¿æŒæ‚¨åŸæœ‰çš„ã€æ•ˆæœè‰¯å¥½çš„CSSæ ·å¼ */
        body { font-family: 'Inter', sans-serif; background-color: #e9eef2; }
        ::-webkit-scrollbar { display: none; }
        .keyword-tag-display { transition: all 0.2s ease-in-out; cursor: pointer; }
        .keyword-tag-display:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        #report-content-wrapper { perspective: 1500px; width: 100%; height: calc(100vh - 350px); min-height: 550px; margin: 0 auto; }
        #report-content { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; padding: 20px 0; height: 100%; }
        .report-card-poster { scroll-snap-align: center; flex: 0 0 calc(min(90%, 595px)); height: calc(100% - 40px); margin: 0 15px; border-radius: 16px; background-color: #ffffff; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); transform-style: preserve-3d; opacity: 0.7; transform: scale(0.9); overflow: hidden; }
        .report-card-poster.is-active { opacity: 1; transform: scale(1); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .poster-grid { display: grid; grid-template-columns: 38% 62%; height: 100%; }
        .poster-left-column { background-color: #f0f4f8; padding: 24px; display: flex; flex-direction: column; justify-content: space-between; border-right: 1px solid #dde4eb; overflow-y: auto; }
        .poster-right-column { padding: 24px; display: flex; flex-direction: column; overflow-y: auto; }
        .poster-section-title { font-size: 0.9rem; font-weight: 600; color: #1e3a8a; margin-top: 16px; margin-bottom: 8px; border-bottom: 2px solid #60a5fa; padding-bottom: 4px; display: inline-block; }
        .poster-interpretation-subsection h5 { font-weight: 700; color: #334155; margin-bottom: 4px; }
        .poster-interpretation-subsection p { font-size: 0.85rem; color: #475569; line-height: 1.6; text-align: justify; }
        .paper-card-new-badge { position: absolute; top: 10px; right: 10px; background-color: #ef4444; color: white; font-size: 0.75rem; font-weight: 700; padding: 2px 8px; border-radius: 9999px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .pagination-dots { display: flex; justify-content: center; align-items: center; margin-top: 20px; gap: 10px; }
        .pagination-dot { width: 10px; height: 10px; border-radius: 50%; background-color: #cbd5e1; cursor: pointer; transition: all 0.2s ease; }
        .pagination-dot.active { background-color: #2563eb; transform: scale(1.2); }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center py-8 px-4">

    <div class="container mx-auto max-w-7xl w-full">
        <header class="mb-6 text-center">
            <h1 class="text-4xl font-bold text-sky-700">å­¦æœ¯å‘¨æŠ¥</h1>
            <p class="text-slate-600 mt-2">æ¯æ—¥æ¸…æ™¨ï¼Œä¸ºæ‚¨å®šåˆ¶ä¸“å±å­¦æœ¯åŠ¨æ€ <span id="update-count-badge" class="hidden ml-2 text-xs font-semibold bg-green-200 text-green-800 px-2 py-0.5 rounded-full"></span></p>
        </header>

        <section id="keywords-display-area" class="mb-8 p-6 bg-white rounded-xl shadow-lg max-w-3xl mx-auto">
            <div class="grid md:grid-cols-2 gap-8 items-start">
                <div>
                    <h3 class="text-lg font-semibold text-sky-600 mb-3 border-b pb-2">ğŸ¯ æ ¸å¿ƒå…´è¶£ç„¦ç‚¹</h3>
                    <div id="manual-keywords-display" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-3 border-b pb-2">
                        <h3 class="text-lg font-semibold text-orange-600">ğŸ”¥ è¿‘æœŸçƒ­ç‚¹è¶‹åŠ¿</h3>
                        <a href="keywords.html" class="text-sm text-sky-600 hover:text-sky-700 hover:underline transition-colors">
                            æŸ¥çœ‹å…¨æ™¯ â†’
                        </a>
                    </div>
                    <div id="hot-keywords-display" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </section>

        <main id="report-content-wrapper">
            <div id="report-content">
                <div id="loading-message-container" class="w-full h-full flex items-center justify-center text-slate-600">
                    <p id="loading-message">æ­£åœ¨åŠ è½½å­¦æœ¯å‘¨æŠ¥...</p>
                </div>
            </div>
        </main>
        <div id="pagination-container" class="pagination-dots"></div>

        <footer class="mt-12 text-center text-sm text-slate-500">
            <p>&copy; <span id="current-year"></span> å­¦æœ¯å‘¨æŠ¥ç”Ÿæˆå™¨.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reportContentDiv = document.getElementById('report-content');
            const paginationContainer = document.getElementById('pagination-container');
            const manualKeywordsContainer = document.getElementById('manual-keywords-display');
            const hotKeywordsContainer = document.getElementById('hot-keywords-display');
            const updateCountBadge = document.getElementById('update-count-badge');
            const LAST_VIEWED_UPDATE_KEY = 'lastViewedUpdateTime';
            let intersectionObserver;

            function renderInterpretation(interpretation) {
                // ... (æ­¤å‡½æ•°ä¸ä¸Šä¸€ç‰ˆç›¸åŒï¼Œä¿æŒä¸å˜) ...
            }

            // ---ã€ä¿®æ­£ç‚¹2ã€‘: æ¢å¤äº† IntersectionObserver äº¤äº’é€»è¾‘ ---
            function setupIntersectionObserver() {
                const cards = document.querySelectorAll('.report-card-poster');
                if (cards.length === 0) return;
                if (intersectionObserver) { intersectionObserver.disconnect(); }

                const options = { root: reportContentDiv, rootMargin: '0px', threshold: 0.6 };

                intersectionObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            cards.forEach(c => c.classList.remove('is-active'));
                            entry.target.classList.add('is-active');
                            updatePaginationDots(Array.from(cards).indexOf(entry.target));
                        }
                    });
                }, options);

                cards.forEach(card => intersectionObserver.observe(card));
            }
            
            function renderPaginationDots(totalCount) {
                paginationContainer.innerHTML = '';
                for (let i = 0; i < totalCount; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'pagination-dot';
                    dot.dataset.index = i;
                    dot.addEventListener('click', () => navigateToCard(i));
                    paginationContainer.appendChild(dot);
                }
                updatePaginationDots(0);
            }
            
            function updatePaginationDots(activeIndex) {
                const dots = paginationContainer.querySelectorAll('.pagination-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeIndex);
                });
            }

            function navigateToCard(index) {
                const cards = reportContentDiv.querySelectorAll('.report-card-poster');
                if (index >= 0 && index < cards.length) {
                    cards[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            }
            
            // --- ä¸»æ•°æ®è·å–ä¸æ¸²æŸ“é€»è¾‘ ---
            fetch('academic_data.json?t=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    const { keywords, papers, lastUpdate } = data;
                    const lastViewedTime = localStorage.getItem(LAST_VIEWED_UPDATE_KEY);

                    // æ¸²æŸ“å…³é”®è¯
                    if (keywords.manual) {
                        manualKeywordsContainer.innerHTML = keywords.manual.map(k => `<span class="keyword-tag-display bg-sky-100 text-sky-700 text-sm font-medium px-3 py-1.5 rounded-full">${k}</span>`).join('');
                    }
                    if (keywords.hot) {
                        hotKeywordsContainer.innerHTML = keywords.hot.map(k => `<span class="keyword-tag-display bg-orange-100 text-orange-700 text-sm font-medium px-3 py-1.5 rounded-full">${k}</span>`).join('');
                    }
                    
                    // ---ã€ä¿®æ­£ç‚¹3ã€‘: æ¸²æŸ“è®ºæ–‡å¡ç‰‡ï¼Œå¹¶åºŸé™¤â€œæŸ¥çœ‹æ›´å¤šâ€
                    reportContentDiv.innerHTML = '';
                    const papersToShow = papers.slice(0, 4);
                    let newPapersCount = 0;

                    if (papersToShow.length === 0) {
                        reportContentDiv.innerHTML = `<div class="w-full h-full flex items-center justify-center text-slate-600"><p>æš‚æ— ç²¾é€‰è®ºæ–‡ã€‚</p></div>`;
                        renderPaginationDots(0);
                        return;
                    }

                    papersToShow.forEach((paper) => {
                        const card = document.createElement('article');
                        card.className = 'report-card-poster';
                        card.style.position = 'relative';

                        const isNew = lastViewedTime && new Date(paper.publicationDate) >= new Date(lastViewedTime);
                        if (isNew) { newPapersCount++; }
                        
                        // ... å¡«å…… card.innerHTML çš„é€»è¾‘ä¸ä¸Šä¸€ç‰ˆç›¸åŒï¼Œä¿æŒä¸å˜ ...
                        // (ä½¿ç”¨ renderInterpretation å‡½æ•°æ¥å¤„ç† interpretation)

                        const authorsHtml = (paper.authors || []).map(author => `${author}`).join(', ');
                        const keywordsHtml = (paper.paperKeywords || []).map(k => `<span class="poster-keywords-tag bg-sky-100 text-sky-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">${k}</span>`).join('');
                        const interpretationHtml = renderInterpretation(paper.interpretation); 
                        const snippetHtml = paper.snippet || "æ‘˜è¦ä¿¡æ¯ä¸å¯ç”¨ã€‚";
                        const titleHtml = paper.title || "æ ‡é¢˜ä¸å¯ç”¨";
                        const journalHtml = paper.journal || "N/A";
                        const pubDateHtml = paper.publicationDate || "N/A";
                        
                        if(isNew) {
                            const newBadge = document.createElement('div');
                            newBadge.className = 'paper-card-new-badge';
                            newBadge.textContent = 'New';
                            card.appendChild(newBadge);
                        }
                        reportContentDiv.appendChild(card);
                    });
                    
                    renderPaginationDots(papersToShow.length);
                    setupIntersectionObserver();
                    
                    // æ¿€æ´»ç¬¬ä¸€å¼ å¡ç‰‡
                    setTimeout(() => {
                        const firstCard = reportContentDiv.querySelector('.report-card-poster');
                        if (firstCard) { firstCard.classList.add('is-active'); }
                    }, 100);

                    // æ›´æ–°â€œæ–°å¢â€è®¡æ•°
                    if (newPapersCount > 0) {
                        updateCountBadge.textContent = `æ–°å¢ ${newPapersCount} ç¯‡`;
                        updateCountBadge.classList.remove('hidden');
                    }

                    // æ›´æ–°æœ¬æ¬¡æŸ¥çœ‹æ—¶é—´
                    localStorage.setItem(LAST_VIEWED_UPDATE_KEY, lastUpdate);
                })
                .catch(error => {
                    console.error('Error fetching or processing data:', error);
                    reportContentDiv.innerHTML = `<div class="w-full h-full flex items-center justify-center text-red-600"><p>âŒ åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æˆ–ç½‘ç»œã€‚</p></div>`;
                });
            
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>